@model Docimax.Interface_ICD.Model.CodeOrderModel
<script type="text/javascript" src="~/Scripts/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="~/Scripts/typeahead.bundle.js"></script>
<h2>@ViewBag.Title</h2>
<p class="text-success">@ViewBag.StatusMessage</p>
<script>
    $(document).ready(function () {
        $('.tree-toggle').click(function () {
            $(this).parent().children('ul.tree').toggle(200);
        });
    });
    function showPic(el) {
        var picURL = $(el).attr("data-url");
        var contentType = $(el).attr("data-contenttype");
        var newSrc = "@Url.Action("ShowPic", "UploadItem")?picURL=" + picURL + "&contentType=" + contentType;
        $("#pic").attr("src", newSrc);
    };
</script>
@using (Html.BeginForm("Code", "ServiceItem", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(model => model.CodeOrderID)
    @Html.HiddenFor(model => model.LastModifyStamp)
    <div style="display:inline">
        @Html.Label("订单号：", htmlAttributes: new { @class = "control-label" })
        @Html.DisplayTextFor(model => model.PlatformOrderCode)
        <hr />
    </div>
    <div style="display:inline">
        <div style="padding-left:0px;padding-right:0px;display:inline">
            <div class="span3">
                @if (Model != null && Model.ItemList != null)
                {
                    <ul class="nav nav-list">
                        @foreach (var item in Model.ItemList)
                        {
                            <li>
                                @Html.Label(item.ItemName, htmlAttributes: new { @class = "tree-toggle nav-header first-level" })
                                <ul class="nav nav-list tree">
                                    @if (item.ChildrenList != null && item.ChildrenList.Count > 0)
                                    {
                                        foreach (var sunItem in item.ChildrenList)
                                        {
                                            <li class="tree">
                                                @Html.Label(sunItem.ItemName, htmlAttributes: new { @class = "tree-toggle nav-header" })
                                                <ul class="nav nav-list tree">
                                                    @foreach (var file in sunItem.UploadedItemList)
                                                    {
                                                        <li>
                                                            <a style="cursor: pointer;" class="tree-nav-a" data-url="@file.AttachURL" data-contenttype="@file.ContentType" onclick="showPic(this)">@file.AttachFileName</a>
                                                        </li>
                                                    }
                                                </ul>
                                            </li>
                                        }
                                    }
                                    else
                                    {
                                        foreach (var file in item.UploadedItemList)
                                        {
                                            <li class="tree">
                                                <a style="cursor: pointer;" class="tree-nav-a" data-url="@file.AttachURL" data-contenttype="@file.ContentType" onclick="showPic(this)">@file.AttachFileName</a>
                                            </li>
                                        }
                                    }
                                </ul>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
        <div style="padding-left:3px;padding-right:3px;display:inline">
            <img id="pic" src="" width="600" height="800" style="border:1px;" />
        </div>
        <div style="display:inline-block; position: fixed;">
            <h4>出院诊断</h4>
            @for (var themeIndex = 0; themeIndex < Model.DiagnosisList.Count(); themeIndex++)
            {
                <div class="form-group">
                    <div class="col-md-4">
                        @Html.TextBoxFor(model => model.DiagnosisList[themeIndex].ICD_Code, new { @class = "form-control", @placeholder = "ICD编码" })
                    </div>
                    @Html.TextBoxFor(model => model.DiagnosisList[themeIndex].ICD_Content, new { @class = "form-control", @placeholder = "诊断" })
                </div>
            }
            <h4>手术操作</h4>
            @for (var themeIndex = 0; themeIndex < Model.OperateList.Count(); themeIndex++)
            {
                <div class="form-group">
                    <div class="col-md-4">
                        @Html.TextBoxFor(model => model.OperateList[themeIndex].ICDCode, new { @class = "form-control", @placeholder = "ICD编码" })
                    </div>
                    @Html.TextBoxFor(model => model.OperateList[themeIndex].ICDContent, new { @class = "form-control", @placeholder = "手术操作" })
                </div>
            }
            <div class="form-group">
                <div class="form-horizontal col-md-4">
                    <input type="submit" value="保存" name="save" id="save" class="btn btn-primary" />
                    @if (Model.OrderStatus.GetHashCode() == Docimax.Interface_ICD.Enum.ICDOrderState.编码中.GetHashCode())
                    {
                        <input type="submit" value="提交" name="submit" id="submit" class=" btn btn-default" />
                    }
                </div>
            </div>
        </div>
    </div>
}
<div class="row">
    @Html.ActionLink("返回订单列表", "Index")
</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
